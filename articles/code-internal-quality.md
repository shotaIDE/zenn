---
title: "コードの内部品質を高める動きをチームに浸透させたい"
emoji: "🕌"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["ios", "android"]
published: false
---

<!-- cspell:ignore detekt, qodana -->

コードの内部品質を高めて、継続的な価値提供を下支えするために、私が取り組んできたことをまとめました。

# 背景

プロダクトで継続的に価値を提供していくために、コードの内部品質を高く保つのは重要です。

内部品質は目に見えにくく定量的な成果が出にくいものであるものの、中・長期的にビジネスの成長に大きく影響してきます。

私がジョインした開発チームでは、内部品質に対する意識がまちまちでした。
コードの内部品質に関して、重要視しているメンバーもいればそうでないメンバーもいるという状況でした。

その中で、技術リードとして、内部品質をチーム全員で高めていくために取り組んできた内容を振り返ってみます。

# やってきたことの概要

まず、内部品質を高めるために、目指すべき方向性を示し、それが重要だと伝えていく活動をしました。

しかし、実際に取り組みが運用されていくことも重要です。
そのため、私がリードとして見本を見せたり、メンバーに働きかけをしたり、仕組み化することで運用されるようにしました。

さらに、取り組みに対して正しい方向に進んでいるかを観測するために、データの可視化や定量的な指標の可視化を行いました。

まとめると以下のような内容です。

- 正しい方向に向かうことの意識づけ
  - マインドセットやミッションステートメントの制定・意識づけ
  - 日々の活動の中で背景を伝える
  - 情報格差をなくす
- 正しい方向に向かうことの運用
  - 草の根活動・手本を見せる
  - ガードレールによる仕組み化
  - 明文化
  - 一定のコストで取り組む
- 正しい方向に向かっていることの観測
  - 定量的なデータの収集と共有
  - フィードバックサイクルの確保

# 1. 正しい方向に向かうことの意識づけ

## 1-1. マインドセットやミッションステートメントの制定・意識づけ

ある程度の規模のチームであると、1 人 1 人に対してマイクロに指示を出していくことは難しいです。
そのため、目指すべき方向性を抽象的に伝えるミッションステートメントを制定し、1 人 1 人に自律的に考えて工夫していってもらうようにしました。

具体的には以下のような内容を伝えました。

リードエンジニアたちに対してのミッションの例。

> 各エンジニアが、自立し、かつ自信を持って開発を進められるよう、必要な能力の伝授や仕組み化を推進する

全体に対してのミッションを掲げました。

> チーム全体で内部品質を高め、困難なバグ対応に苦しむことなく、クールに価値提供していけるチームを目指す

また、マインドセットとしては、以下のようなものを伝えました。

- いつやるか？ → 全てのタスクで
- 誰がやるか？ → 全員で
- スピードよりも内部品質の高さを優先する
- 必要と思ったことは、誰かに許可を取る必要はないので、どんどんチャレンジしていってみてください。

## 1-2. 日々の活動の中で背景を伝える

メンバーにやってもらいたいことを伝えるとき、内容だけでなく、なぜそれをやってもらいたいのかを意識的に伝えるようにしました。

例えば以下のような内容です。

```text
この
```

こうした取り組みを行うことで、折に触れてメンバーが目指すべき方向性を意識してもらえるように工夫しました。

## 1-3. 情報格差をなくす

開発プロセスに関する情報格差があると、何にコストをかけるべきかが人によってばらつきが大きくなってしまいます。

情報格差をなくすために、以下のような取り組みを行いました。

# 2. 正しい方向に向かうことの運用

## 2-1. 草の根活動・手本を見せる

ルールは決めただけではダメで、正しく運用されるために、何度でもメンバーに働きかけをすることが重要と考えています。

そのため、自分が実装する際に手本を見せたり、メンバーのコードレビュー時に指摘をすることで、メンバーに示すことができます。

## 2-2. ガードレール

内部品質に関する改善は、細かい部分の議論が多くなりがちです。
そのような場合に、人間が判断するのではなく、自動で指摘されるようにすることで、無駄に感情コストをかける必要がなくなります。

また、規約が設定されていないと、結論を決められずに議論が無駄に長引いてしまうことがあるため、自動で規約を設定することが重要です。

具体的には、以下のような内容を設定しました。

PR での自動チェック

| 項目                         | 利用ツール                                   |
| ---------------------------- | -------------------------------------------- |
| 静的解析の指摘が増えていない | SwiftLint、SwiftFormat、Android Lint、detekt |
| デッドコードが増えていない   | Periphery、Qodana                            |
| Typo が増えていない          | CSpell                                       |

:::message
途中からこのような仕組みを導入したため、導入時点の指摘は一旦 Baseline のような形で無視するようにました。
そのため、Baseline より指摘が増えていないことをチェックするようにしています。
:::

- 開発プロセスやコード品質の定量的な測定と観察
  - コード品質が順調に維持・向上しているかを確認できるようになった
  - 開発メンバーがコード品質のメトリクス(単体テストのコードカバレッジ)を意識する場面が見られた

## 2-3. 明文化

ここは後で書きます。

## 2-4. 一定のコストで取り組む

短期的な成果が見えにくい内部品質向上の取り組みは、他の業務に比べて優先度が低くなりがちです。

特に機能開発やバグ修正など、ユーザーに直接価値を提供するプレッシャーが強いと、内部品質向上の取り組みが後回しになりがちです。

一番簡単な方法は、内部品質向上の取り組みに対して、常に一定のコストを用意することです。

このプロジェクトでは、毎スプリントの 1 〜2 割程度のコストを必ず内部品質向上の取り組みへ充てるようにしました。

週次のメンテナンスタスクの実施により、各メンバーが様々な内部品質に関するトピックに対して意識を向けるようになりました。

開発メンバーが背景に関するコードコメントを書くようになった。

# 3. 正しい方向に向かっていることの観測

## 3-1. 定量的なデータの収集と共有

内部品質に関する定量的なデータに関しては、定期的に収集してチームへ共有するようにしました。

例えば以下のようなデータです。

- 単体テストのカバレッジ

よくある失敗として、定量的なデータを評価基準とすると、その評価基準にのみ最適化されてしまうことがあります。
定量的に収集できる内部品質のデータは、一部の指標に過ぎないため、その指標にのみ最適化されてしまうと、継続的な価値提供につながらないパターンがあります。

## 3-2. フィードバックサイクルの確保

定性的な意見によるフィードバックサイクルも確保しておくことが重要です。

## 3-3. 開発チームや開発プロセスに対する理解

- 開発メンバーの強み・弱みの理解
  - 強み
    - 決められた外部仕様を確実に実装する
    - 外部仕様に決められていないエラーハンドリングを考慮
  - 弱み
    - サービスの中の相対的な価値を踏まえた仕様検討
    - 修正に対する既存実装の影響箇所の把握と、それを考慮した実装
    - デグレを防ぐために効果的な自動テストの実装
- 内部品質の向上のためのノウハウ
  - 実装方法を JP 側から具体的に提示する方法はあまりうまくいかなかった
  - 意識づけを行う（現状よりも内部品質をより高めていきつつ、リーダーだけでなく全員で取り組むなど）ことで、自律的に取り組んでいく様子が見られた
