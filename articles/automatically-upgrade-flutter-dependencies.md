---
title: "ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã«æ™‚é–“ã‹ã‹ã‚Šã™ãã¦ã€æ›´æ–°ä½œæ¥­ã ã‘ã§äººç”Ÿçµ‚ã‚ã£ã¡ã‚ƒã†ã¨ã„ã†å±æ©Ÿæ„Ÿã‚’æŒã¤äººã«é€ã‚‹ï¼"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["flutter", "ios", "android"]
published: false
---

<!-- cspell:ignore automerge, noreply, podfile, precache, subosito, temurin -->

# ã¯ã˜ã‚ã«

ã‚¢ãƒ—ãƒªé–‹ç™ºã§ã€é‹ç”¨ã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ã‹ã‹ã‚‹ã‚³ã‚¹ãƒˆã¯ã§ãã‚‹ã ã‘å‰Šæ¸›ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

ç‰¹ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ã¯ã€ã‚¢ãƒ—ãƒªã®å“è³ªã‚’ä¿ã¤ãŸã‚ã«æ¬ ã‹ã›ãªã„ä½œæ¥­ã®ä¸€æ–¹ã§ã€ãã®æ›´æ–°ä½œæ¥­è‡ªä½“ãŒã‚³ã‚¹ãƒˆã‚’ç”Ÿã‚€ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€Flutter ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ã‚’è‡ªå‹•åŒ–ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

# æ¦‚è¦

Renovate ã‚’å°å…¥ã—ã€PR ä½œæˆã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€Flutter ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¾å­˜é–¢ä¿‚å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ›´æ–°ã•ã‚ŒãŸ PR ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

CI ã«ã‚ˆã‚Šã€Flutter ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒé–“æ¥çš„ã«åˆ©ç”¨ã™ã‚‹ iOS ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã€PR ã«ãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

Renovate ã®è‡ªå‹•ãƒãƒ¼ã‚¸ã«ã‚ˆã‚Šã€ãƒãƒ¼ã‚¸ã•ã‚Œã¾ã™ã€‚

# è©³ç´°

## å‰æ

GitHub ã§é–‹ç™ºã—ã€GitHub Actions ã§ CI ã‚’çµ„ã‚“ã§ã„ã‚‹å‰æã§èª¬æ˜ã—ã¾ã™ã€‚

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–° PR ã¯ã€**1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¤ã 1PR** ã¨ã—ã¦ã„ã¾ã™ã€‚
ãŸã ã—ã€Renovate ã®è¨­å®šã«ã‚ˆã‚Šã€è¤‡æ•°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ 1PR ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ã¾ãŸã€æœ¬è¨˜äº‹ã§å‰æã¨ã—ã¦ã„ã‚‹ã®ã¯ã‚¢ãƒ—ãƒªé–‹ç™ºã§ã™ã€‚
ãã®ãŸã‚ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®**æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã‚‰ã€ã§ãã‚‹ã ã‘æ—©ãæœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã®åˆ¶ç´„ã‚’æ›´æ–°**ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

:::message
ä¸€æ–¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè‡ªä½“ã®é–‹ç™ºã§ã¯ã€ãã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒåˆ©ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¶ç´„ã¯åºƒãå–ã‚Šã€åˆ¶ç´„ã®æ›´æ–°è‡ªä½“ã‚‚ç·©ã‚„ã‹ã«è¡Œã†ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚
ã“ã‚Œã¯ã€ä»–ã®äººã‚„ãƒãƒ¼ãƒ ã‹ã‚‰æ§˜ã€…ãªçŠ¶æ³ã«ãŠã„ã¦åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè‡ªä½“ã®é–‹ç™ºã«ãŠã„ã¦ã¯é©ã—ã¦ã„ãªã„æ–¹æ³•ã«ãªã£ã¦ã„ã¾ã™ã€‚
:::

## Flutter ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜é–¢ä¿‚ã®å®šç¾©æ–¹æ³•ã‚’å¤‰æ›´

`pubspec.yaml` ã«ãŠã‘ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã¯ã€ã‚­ãƒ£ãƒ¬ãƒƒãƒˆæ¼”ç®—å­ `^` ã‚’ä½¿ã†ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚

ä¸€æ–¹ã§ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºã§ã¯ãªãã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã¯ã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¾å­˜é–¢ä¿‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã‚‰ã€ã™ãã«æœ€æ–°ç‰ˆã«æ›´æ–°ã™ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚

ãŸã ã€Renovate ã¯ `pubspec.yaml` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¦‹ã¦æ›´æ–° PR ã‚’æå‡ºã™ã‚‹ã‹å¦ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚

ãã“ã§ã€è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³çµ¶å¯¾æŒ‡å®šã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff yaml:pubspec.yaml
name: app_name
description: App description.
publish_to: "none"
version: 1.0.0+1

environment:
  sdk: ">=2.18.5 <3.0.0"
  flutter: ">=3.19.5"

dependencies:
-  cloud_firestore: ^4.15.10
+  cloud_firestore: 4.15.10
-  collection: ^1.18.0
+  collection: 1.18.0
# ...
```

## Renovate ã®å°å…¥

Renovate ã¯ã€GitHub ã®ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://docs.renovatebot.com/

ä»¥ä¸‹ã® "Hosted GitHub.com App" ã‚’å‚è€ƒã«ã—ã¦ã€GitHub App ã¨ã—ã¦è©²å½“ã®ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

https://docs.renovatebot.com/getting-started/installing-onboarding/#hosted-githubcom-app

## Renovate ã®è¨­å®š

Renovate ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè‡ªå‹•æ›´æ–°ã®æ¨å¥¨è¨­å®šãŒé©ç”¨ã•ã‚ŒãŸ PR ãŒæå‡ºã•ã‚Œã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/renovate-configure-pr.png)

ãã®ã¾ã¾ãƒãƒ¼ã‚¸ã¯ã›ãšã€é©ã—ãŸè¨­å®šã«ä¿®æ­£ã—ã¾ã™ã€‚

ä»¥ä¸‹ãŒä¿®æ­£å¾Œã®è¨­å®šã®å…¨å®¹ã§ã™ã€‚

```json:renovate.json
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "enabledManagers": ["pub"],
  "packageRules": [
    {
      "matchManagers": ["pub"],
      "automerge": true
    }
  ],
  "prConcurrentLimit": 4
}
```

`prConcurrentLimit` ã¯ã€åŒæ™‚ã«æå‡ºã•ã‚Œã‚‹ PR ã®æ•°ã‚’åˆ¶é™ã™ã‚‹ãŸã‚ã®è¨­å®šã§ã™ã€‚
PR ãŒåŒæ™‚ã«å¤§é‡ã«ç™ºç”Ÿã—ã¦ãƒã‚¤ã‚ºã«ãªã‚‰ãªã„ã‚ˆã†ã«ã€é©åˆ‡ãªæ•°ã«è¨­å®šã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚

ã“ã®ã‚ˆã†ã«ä¿®æ­£å¾Œã€PR ã‚’ãƒãƒ¼ã‚¸ã—ã¾ã™ã€‚

## GitHub Actions ã§ãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã™ã‚‹éš›ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”¨æ„ã™ã‚‹

iOS ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã€ãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã—ã¾ã™ã€‚
æ›´æ–°ã—ãŸå¾Œã®ãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã«ã‚ˆã‚Š CI ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®éš›ã€GitHub Actions ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§åˆ©ç”¨ã§ãã‚‹ `GITHUB_TOKEN` ã«ã‚ˆã‚Šãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã™ã‚‹ã¨ã€CI ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã›ã‚“ã€‚
ã“ã‚Œã¯ã€æ„å›³ã›ãš CI ãŒå¤§é‡ã«å‹•ä½œã—ã¦çµŒæ¸ˆçš„ãªæå¤±ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã€GitHub ã®ä»•æ§˜ã§ã™ã€‚

https://docs.github.com/ja/actions/using-workflows/triggering-a-workflow#triggering-a-workflow-from-a-workflow

:::message
`GITHUB_TOKEN` ã¯ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒˆãƒªã‚¬ãƒ¼ã«ã¯ä½¿ãˆã¾ã™ãŒã€ãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã«ã¯ä½¿ãˆã¾ã›ã‚“ã€‚
:::

ã“ã‚Œã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã® 3 ç¨®é¡ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

1. GitHub Apps ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã†
2. å€‹äººãƒˆãƒ¼ã‚¯ãƒ³(Fine-grained)ã‚’ä½¿ã†
3. å€‹äººãƒˆãƒ¼ã‚¯ãƒ³(ã‚¯ãƒ©ã‚·ãƒƒã‚¯)ã‚’ä½¿ã†

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé‹ç”¨ä¸Š GitHub Apps ã§ä½œæˆã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã†æ–¹ãŒè‰¯ã„ã§ã™ãŒã€ä»Šå›ã¯ä¸€ç•ªç°¡å˜ãªå€‹äººãƒˆãƒ¼ã‚¯ãƒ³(ã‚¯ãƒ©ã‚·ãƒƒã‚¯)ã‚’ä½¿ã†æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚

å€‹äººãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™ã€‚

https://github.com/settings/tokens

"Generate new token (classic)" ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/create-personal-access-token.png)

"Note" ã«ä»»æ„ã®åå‰ã‚’å…¥åŠ›ã—ã€"Expiration" ã‚’å¥½ããªå€¤ã«è¨­å®šã—ã¾ã™ã€‚
ã¾ãŸã€"Select scopes" ã«ãŠã‘ã‚‹ "repo" ã®ã‚¹ã‚³ãƒ¼ãƒ—ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/personal-access-token-settings.png)

ä½œæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/created-personal-access-token.png)

ãƒªãƒã‚¸ãƒˆãƒªã® "Settings" ã«ç§»å‹•ã—ã€"Secrets and variables" > "Actions" ã‚’é–‹ãã€"New repository secret" ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/repository-secrets.png)

`GH_PERSONAL_ACCESS_TOKEN` ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/add-repository-secrets.png)

:::message
`GITHUB_` ã¨ã„ã†åå‰ã¯ GitHub ã«ã‚ˆã‚Šç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`GH_` ã¨ã—ã¦ã„ã¾ã™ã€‚
:::

## iOS ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã€ãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã™ã‚‹

æ¬¡ã«ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```yaml:.github/workflows/ios.yml
name: CI / iOS

on:
  pull_request:
    branches:
      - "main"

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write

jobs:
  push-back-diffs-if-needed:
    name: Push back diffs after resolving dependencies if needed
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          token: ${{ secrets.GH_PERSONAL_ACCESS_TOKEN }}
      - name: Setup Git
        # Git ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ "github-actions[bot]" ã‚’è¨­å®šã™ã‚‹
        # https://github.com/actions/checkout/issues/13#issuecomment-724415212
        run: |
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
      - uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
      - uses: subosito/flutter-action@v2
      - name: Install iOS dependencies
        run: |
          flutter pub get --no-example
          flutter precache --ios
          cd ios
          pod install
      - name: Commit
        run: |
          git add ios/Podfile.lock
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m 'build: fix Podfile.lock'
          fi
      - name: Push back if needed
        run: |
          BRANCH_NAME="${{ github.event.pull_request.head.ref }}"
          git push origin "$BRANCH_NAME"
```

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®èª¬æ˜ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

`Install iOS dependencies` ã¯ã€iOS ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€iOS ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

```shell:Install iOS dependencies
flutter pub get --no-example
flutter precache --ios
cd ios
pod install
```

`Commit` ã¯ã€æ›´æ–°ã•ã‚ŒãŸãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚

`ios/Podfile.lock` ã«æ›´æ–°ãŒã‚ã‚‹å ´åˆã€ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã€‚

# å®Ÿéš›ã«å‹•ä½œã—ã¦ã„ã‚‹æ§˜å­

Renovate ãŒ PR ã‚’ä½œæˆã—ã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/pr-by-renovate.png)

æœ€åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒŸãƒƒãƒˆãŒä½œæˆã•ã‚Œã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/first-commit-by-renoate.png)

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒŸãƒƒãƒˆãŒãƒ—ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯ã•ã‚Œã€CI ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/push-back-commit.png)

CI ãŒãƒ‘ã‚¹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã« PR ãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã™ã€‚

![](/images/automatically-upgrade-flutter-dependencies/auto-merge-by-renovate.png)

# ã¾ã¨ã‚
